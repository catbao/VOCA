{"remainingRequest":"/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/node_modules/babel-loader/lib/index.js!/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/node_modules/ts-loader/index.js??ref--15-2!/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/node_modules/eslint-loader/index.js??ref--14-0!/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/src/indexdb/index.ts","dependencies":[{"path":"/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/src/indexdb/index.ts","mtime":1732546288000},{"path":"/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/babel.config.js","mtime":1732546288000},{"path":"/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/node_modules/cache-loader/dist/cjs.js","mtime":1732627998206},{"path":"/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/node_modules/babel-loader/lib/index.js","mtime":1732627998426},{"path":"/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/node_modules/ts-loader/index.js","mtime":1732627997224},{"path":"/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/node_modules/eslint-loader/index.js","mtime":1732627997140}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLmRldGFjaGVkLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLnRyYW5zZmVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLnRyYW5zZmVyLXRvLWZpeGVkLWxlbmd0aC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmF0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmluZC1sYXN0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmluZC1sYXN0LWluZGV4LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2V0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudG8tcmV2ZXJzZWQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS50by1zb3J0ZWQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS53aXRoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1leGNlcHRpb24uc3RhY2suanMiOwpsZXQgaXNPcGVuID0gZmFsc2U7CmZ1bmN0aW9uIGJhc2U2NFN0cmluZ1RvQXJyYXkoc3RyKSB7CiAgLy8g5YGH6K6+6KaB5a2Y5YKo55qEIEJhc2U2NCDmlbDmja7kuLogYmFzZTY0U3RyaW5nCiAgY29uc3QgYnl0ZUNoYXJhY3RlcnMgPSBhdG9iKHN0cik7CiAgY29uc3QgYnl0ZU51bWJlcnMgPSBuZXcgQXJyYXkoYnl0ZUNoYXJhY3RlcnMubGVuZ3RoKTsKICBmb3IgKGxldCBpID0gMDsgaSA8IGJ5dGVDaGFyYWN0ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICBieXRlTnVtYmVyc1tpXSA9IGJ5dGVDaGFyYWN0ZXJzLmNoYXJDb2RlQXQoaSk7CiAgfQogIGNvbnN0IGJ5dGVBcnJheSA9IG5ldyBVaW50OEFycmF5KGJ5dGVOdW1iZXJzKTsKICByZXR1cm4gYnl0ZUFycmF5Owp9CmxldCBpbmRleERiID0gbnVsbDsKZXhwb3J0IGZ1bmN0aW9uIGluaXRJbmRleERCKCkgewogIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3Blbigib21fZmxhZ19kYiIsIDEpOwogIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAvL0B0cy1pZ25vcmUKICAgIGNvbnN0IGRiID0gZXZlbnQudGFyZ2V0LnJlc3VsdDsKICAgIGNvbnN0IG9iamVjdFN0b3JlID0gZGIuY3JlYXRlT2JqZWN0U3RvcmUoIm9tM19mbGFnIiwgewogICAgICBrZXlQYXRoOiAidXJsIgogICAgfSk7CiAgfTsKICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlaikgPT4gewogICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIGNvbnNvbGUubG9nKGV2ZW50KTsKICAgICAgY29uc29sZS5lcnJvcigiaW5kZXhkYiBlcnJvciwgd2hpY2ggd2lsbCBjYXNlIGZsYWcgY2Fubm90IHN0b3JlIGluIGxvY2FsIik7CiAgICAgIHJlaigiIik7CiAgICB9OwogICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgLy9AdHMtaWdub3JlCiAgICAgIGNvbnN0IGRiID0gZXZlbnQudGFyZ2V0LnJlc3VsdDsKICAgICAgaW5kZXhEYiA9IGRiOwogICAgICBpc09wZW4gPSB0cnVlOwogICAgICByZXNvbHZlKCcnKTsKICAgICAgLy8g5Zyo6L+Z6YeM6L+b6KGM5ZCO57ut5pON5L2c77yM5L6L5aaC6K+75Y+W5oiW5YaZ5YWl5pWw5o2uCiAgICB9OwogIH0pOwp9CmV4cG9ydCBmdW5jdGlvbiBnZXRJbmRleERCKCkgewogIHJldHVybiBpbmRleERiOwp9CmV4cG9ydCBmdW5jdGlvbiBpbmRleFB1dERhdGEodXJsLCBzdHIpIHsKICBpZiAoIWlzT3BlbikgewogICAgaW5kZXhEYigpOwogICAgcmV0dXJuOwogIH0KICBjb25zdCB0cmFuc2FjdGlvbiA9IGluZGV4RGIudHJhbnNhY3Rpb24oWyJvbTNfZmxhZyJdLCAicmVhZHdyaXRlIik7CiAgY29uc3Qgb2JqZWN0U3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZSgib20zX2ZsYWciKTsKICBjb25zdCBkdGEgPSB7CiAgICB1cmw6IHVybCwKICAgIGJpbmFyeURhdGE6IGJhc2U2NFN0cmluZ1RvQXJyYXkoc3RyKQogIH07CiAgb2JqZWN0U3RvcmUucHV0KGR0YSk7Cn0KZXhwb3J0IGZ1bmN0aW9uIGluZGV4R2V0RGF0YSh1cmwpIHsKICBpZiAoIWlzT3BlbikgewogICAgaW5pdEluZGV4REIoKTsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY29uc3QgdHJhbnNhY3Rpb24gPSBpbmRleERiLnRyYW5zYWN0aW9uKFsib20zX2ZsYWciXSwgInJlYWRvbmx5Iik7CiAgY29uc3Qgb2JqZWN0U3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZSgib20zX2ZsYWciKTsKICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgaWYgKGluZGV4RGIgPT09IG51bGwpIHsKICAgICAgcmVzb2x2ZSgnJyk7CiAgICB9CiAgICBjb25zdCBnZXRSZXF1ZXN0ID0gb2JqZWN0U3RvcmUuZ2V0KHVybCk7CiAgICBnZXRSZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICBjb25zdCByZXN1bHQgPSBldmVudC50YXJnZXQucmVzdWx0OwogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgY29uc3QgYnl0ZUFycmF5ID0gcmVzdWx0LmJpbmFyeURhdGE7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgY29uc3QgYnl0ZUNoYXJhY3RlcnMgPSBBcnJheS5mcm9tKGJ5dGVBcnJheSwgYnl0ZSA9PiBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ5dGUpKS5qb2luKCcnKTsKICAgICAgICBjb25zdCBiYXNlNjRTdHJpbmcgPSBidG9hKGJ5dGVDaGFyYWN0ZXJzKTsKICAgICAgICAvLyDkvb/nlKjovazmjaLlkI7nmoQgQmFzZTY0IOaVsOaNrgogICAgICAgIHJlc29sdmUoYmFzZTY0U3RyaW5nKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDmlbDmja7kuI3lrZjlnKgKICAgICAgICByZXNvbHZlKCcnKTsKICAgICAgfQogICAgfTsKICAgIGdldFJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICByZWplY3QoImdldCBmbGFnIGZhaWwiKTsKICAgICAgLy8g6K+75Y+W5aSx6LSlCiAgICB9OwogIH0pOwp9CmV4cG9ydCBmdW5jdGlvbiBjbGVhckZsYWdEQigpIHsKICBpZiAoaXNPcGVuICYmIGluZGV4RGIpIHsKICAgIGluZGV4RGIuY2xvc2UoKTsKICAgIGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZSgib21fZmxhZ19kYiIpOwogICAgaXNPcGVuID0gZmFsc2U7CiAgICBjb25zb2xlLndhcm4oImNsZWFyIGluZGV4ZGIgZmxhZyIpOwogIH0KfQ=="},{"version":3,"names":["isOpen","base64StringToArray","str","byteCharacters","atob","byteNumbers","Array","length","i","charCodeAt","byteArray","Uint8Array","indexDb","initIndexDB","request","indexedDB","open","onupgradeneeded","event","db","target","result","objectStore","createObjectStore","keyPath","Promise","resolve","rej","onerror","console","log","error","onsuccess","getIndexDB","indexPutData","url","transaction","dta","binaryData","put","indexGetData","reject","getRequest","get","from","byte","String","fromCharCode","join","base64String","btoa","clearFlagDB","close","deleteDatabase","warn"],"sources":["/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/node_modules/eslint-loader/index.js??ref--14-0!/Users/huangshuo/Desktop/cxsj/om3-extend/om3-client/src/indexdb/index.ts"],"sourcesContent":["\nlet isOpen = false\n\nfunction base64StringToArray(str: string) {\n    // 假设要存储的 Base64 数据为 base64String\n    const byteCharacters = atob(str);\n    const byteNumbers = new Array(byteCharacters.length);\n    for (let i = 0; i < byteCharacters.length; i++) {\n        byteNumbers[i] = byteCharacters.charCodeAt(i);\n    }\n    const byteArray = new Uint8Array(byteNumbers);\n    return byteArray\n}\n\nlet indexDb: any = null\n\nexport function initIndexDB() {\n    const request = indexedDB.open(\"om_flag_db\", 1);\n\n    request.onupgradeneeded = function (event) {\n        //@ts-ignore\n        const db = event.target.result\n        const objectStore = db.createObjectStore(\"om3_flag\", { keyPath: \"url\" });\n    }\n    return new Promise((resolve, rej) => {\n        request.onerror = function (event) {\n            console.log(event);\n            console.error(\"indexdb error, which will case flag cannot store in local\",)\n            rej(\"\")\n        }\n        request.onsuccess = function (event) {\n            //@ts-ignore\n            const db = event.target.result;\n            indexDb = db;\n            isOpen = true\n            resolve('');\n\n            // 在这里进行后续操作，例如读取或写入数据\n        };\n    })\n\n}\n\nexport function getIndexDB() {\n    return indexDb\n}\n\nexport function indexPutData(url: string, str: string) {\n    if(!isOpen){\n        indexDb()\n        return\n    }\n\n    const transaction = indexDb.transaction([\"om3_flag\"], \"readwrite\");\n    const objectStore = transaction.objectStore(\"om3_flag\");\n    const dta = { url: url, binaryData: base64StringToArray(str) }\n    objectStore.put(dta);\n}\n\nexport function indexGetData(url: string) {\n    if(!isOpen){\n        initIndexDB()\n        return false\n    }\n\n    const transaction = indexDb.transaction([\"om3_flag\"], \"readonly\");\n    const objectStore = transaction.objectStore(\"om3_flag\");\n\n    return new Promise((resolve, reject) => {\n        if (indexDb === null) {\n            resolve('')\n        }\n        const getRequest = objectStore.get(url);\n\n        getRequest.onsuccess = function (event: any) {\n            const result = event.target.result;\n            if (result) {\n                const byteArray = result.binaryData;\n                //@ts-ignore\n                const byteCharacters = Array.from(byteArray, byte => String.fromCharCode(byte)).join('');\n                const base64String = btoa(byteCharacters);\n                // 使用转换后的 Base64 数据\n                resolve(base64String)\n            } else {\n                // 数据不存在\n                resolve('')\n            }\n        };\n\n        getRequest.onerror = function (event: any) {\n            reject(\"get flag fail\")\n            // 读取失败\n        };\n    })\n}\n\nexport function clearFlagDB() {\n    if (isOpen && indexDb) {\n        indexDb.close();\n        indexedDB.deleteDatabase(\"om_flag_db\");\n        isOpen=false\n        console.warn(\"clear indexdb flag\");\n    }\n\n}"],"mappings":"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","ignoreList":[]}]}